# 2026-02-07 Session Notes

## FluxAnalyzer — Review Workflow Enhancements (Evening Session)

### New Features Added

**1. Variance Filter (Numerical)**
- Dropdown: All / Greater than / Less than / Between
- Dynamic inputs for threshold values
- Filters by absolute variance amount
- Combines with status filter

**2. Assignment Workflow**
- **Schema**: Added `assignedToId`, `assignedAt` to Flux model
- **Migration**: `add_flux_assignment` applied
- **Bulk Actions**: "Assign" button opens user picker modal
- **API**: PUT + POST `/api/flux` support `assign`/`unassign` actions
- **Notifications**: Email + Slack DM when assigned
- **Audit**: `FLUX_ASSIGNED`, `FLUX_UNASSIGNED` actions logged

**3. "By Assignee" Work Management View**
- Tab navigation: "Variance Items" | "By Assignee"
- Summary stats: Total / Assigned / Completed / Remaining
- Assignee cards with:
  - Avatar, name, email
  - Stats: Assigned | Pending | Done
  - Progress bar (turns green at 100%)
  - Expandable drill-in table
- "Unassigned" bucket at bottom
- Review modal works from both views

### Files Modified
- `prisma/schema.prisma` — Flux.assignedToId, User.assignedFluxes
- `src/app/api/flux/route.ts` — assign/unassign actions
- `src/lib/notifications.ts` — notifyFluxAssignment()
- `src/lib/email.ts` — sendAssignmentNotificationEmail()
- `src/lib/audit.ts` — FLUX_ASSIGNED, FLUX_UNASSIGNED
- `src/app/runs/[id]/page.tsx` — UI for all features

### Status
- Deployed to Railway (in progress as of 23:10 EST)
- Ready for testing

---

## ExpertAgent + Frexplorer Integration

### Two Separate Railway/GitHub Setups
| Account | GitHub Repo | Railway Domain |
|---------|-------------|----------------|
| **oregpt** | oregpt/ExpertAgent | expert-agent-production.up.railway.app |
| **agenticledger** | agenticledger/ExpertAgent_forFrexplorer | expertagentforfrexplorer-production.up.railway.app |

### pgvector Database Migration
- Both Railway Postgres instances lacked pgvector extension
- Deployed Railway's pgvector template for both accounts
- **New DB connection strings:**
  - oregpt: `postgres://postgres:qq1DL38clAkidZi6H4_cBTZa_ACVt-13@crossover.proxy.rlwy.net:54813/railway`
  - agenticledger: `postgres://postgres:jqH_H6VBQEOPQA2U_sNLD77vSBFANvo8@yamabiko.proxy.rlwy.net:17135/railway`
- Migrated 21 tables, fixed primary keys, converted embedding columns from text → vector(1536)

### Frexplorer API Backend
- **Backend URL:** `https://backend-production-2871d.up.railway.app`
- Frontend at `frexplorer.agenticledger.ai` is separate (Next.js)
- Updated Frexplorer MCP to use correct backend URL and endpoints:
  - `/api/public/supported-chains` (not /chains)
  - `/api/public/balances` (not /balance)
  - `/api/public/check-support?chain=X`
- Tested: Vitalik's wallet shows 32.11 ETH ✅

### Finney 30-in-30 Updates
- Day 2 (Wire Transfer Logger) completed:
  - Live: https://app-production-580e.up.railway.app/
  - GitHub: agenticledger/finney-wire-transfer-logger-d610-rz4u
  - Exchange: https://finney.finance/exchange/wire-transfer-logger
- Updated nightly cron job with explicit Railway deploy + Exchange publish instructions

## Key Fixes Applied
1. RAG service gracefully skips when pgvector unavailable
2. Primary keys added to all 21 tables after migration
3. Embedding columns converted from text to vector(1536) type
4. Frexplorer MCP API client updated with correct backend URL
